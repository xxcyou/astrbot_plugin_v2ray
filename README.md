# astrbot_plugin_v2ray

一个用于获取 V2Ray 节点的 AstrBot 插件。

## 功能

- 提供 MCP 工具"偷节点来用"
- 当用户需要节点或者偷群主节点时自动调用
- 从订阅源获取节点并检查可用性
- 使用缓存机制减少重复的网络请求和ping操作（缓存有效期1小时）

## 使用方法

该插件通过 MCP 工具方式工作，不需要指令调用。当用户有描述需要节点或者偷群主节点时，AI 会自动调用此工具。

工具说明：偷节点来用
触发条件：用户描述需要节点或者偷群主节点
参数：无

也可以使用测试指令手动测试：
- `/test_node` - 测试节点获取功能

## 安装

1. 将此插件文件夹复制到 AstrBot 的 `data/plugins/` 目录下
2. 在 AstrBot WebUI 的插件管理页面点击"重载插件"
3. 启用插件即可

## 工作原理

1. 插件从指定的订阅源获取 V2Ray 节点信息
2. 解析并解码 Base64 格式的订阅内容
3. 并发检查所有节点的 TCP 连接可用性（最多检查30个节点）
4. 将可用节点信息缓存1小时
5. 随机选择一个可用节点返回给用户
6. 如果缓存有效，则直接从缓存中选择节点，避免重复的网络请求

## 测试

可以使用测试脚本来验证插件功能是否正常：

```bash
python test_node_fetcher.py
```

## 配置

插件支持以下配置项：

- `enable_node_tool`：是否启用节点工具（布尔值，默认启用）

## 版本历史

- v1.0.11：简化日志输出，只保留关键信息
- v1.0.10：优化日志前缀，增强日志可读性
- v1.0.9：添加测试指令，优化节点检查逻辑和调试信息
- v1.0.8：使用TCP连接检查替代ping命令，增强兼容性
- v1.0.7：增强错误处理和日志信息，限制并发检查节点数
- v1.0.6：初始版本

## 注意事项

- 本插件仅用于学习和参考，请遵守相关法律法规
- 实际使用时需要确保网络环境可以访问订阅源和节点地址
- 插件依赖 aiohttp 库，请确保已安装